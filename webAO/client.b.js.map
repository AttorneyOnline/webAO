{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./webAO/client.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","queryDict","location","search","substr","split","forEach","item","serverIP","ip","AO_HOST","asset","MUSIC_HOST","oldLoading","test","navigator","userAgent","selectedShout","lastICMessageTime","Date","Client","address","_this","this","_classCallCheck","serv","WebSocket","onopen","evt","onOpen","onclose","onClose","onmessage","onMessage","onerror","onError","playerID","charID","chars","emotes","selectedEmote","checkUpdater","musicList","handlers","MS","args","handleMS","CT","handleCT","MC","handleMC","RMC","handleRMC","CI","handleCI","SC","handleSC","EI","handleEI","EM","handleEM","SM","handleSM","BD","handleBD","music","handlemusic","DONE","handleDONE","BN","handleBN","NBG","handleNBG","HP","handleHP","ID","handleID","PN","handlePN","SI","handleSI","CharsCheck","handleCharsCheck","PV","handlePV","CHECK","_lastTimeICReceived","message","send","concat","escapeChat","speaking","silent","side","ssfxname","zoom","ssfxdelay","objection","track","_this2","hashCode","setInterval","sendCheck","character","song","e","document","getElementById","style","display","client","joinServer","console","error","reason","code","textContent","cleanup","msg","data","debug","header","handler","warn","close","clearInterval","viewport","chatmsg","content","innerHTML","pre","escape","preanim","nameplate","sound","type","snddelay","evidence","flash","color","isnew","length","className","say","oocLog","scrollTop","scrollHeight","pause","src","play","musicname","appendICLog","Audio","totime","offset","getTime","addEventListener","currentTime","parseFloat","toFixed","chargs","desc","icon","hmusiclist","newentry","createElement","text","options","add","bgname","clip","tr","td","icon_chosen","thispick","appendChild","changeBackground","me","xhr","XMLHttpRequest","open","responseType","onload","status","linifile","responseText","pinifile","INI","parse","Options","Emotions","number","emoteinfo","esfx","esfxd","SoundN","SoundT","sfx","sfxdelay","button_off","button_on","pickemotion","Viewport","textnow","startspeaking","blip","volume","blipChannels","Array","currentBlipChannel","sfxaudio","sfxplayed","updater","shoutTimer","textTimer","_animating","_this3","clearTimeout","setTimeout","updateText","_this4","trim","shout","1","2","3","fontSize","offsetHeight","replace","stylecolor","0","4","5","6","charAt","substring","regex","section","param","comment","lines","line","match","onOOCEnter","event","keyCode","sendOOC","onEnter","mychar","myemo","myEmote","checked","sendIC","musiclist_click","playtrack","sendMusicChange","changeMusicVolume","changeSFXVolume","changeBlipVolume","setBlipVolume","changeCharacter","sendLeaveRoom","imgError","image","demoError","position","standname","bgfolder","bgFolder","ReconnectButton","RetryButton","toadd","arguments","undefined","time","entry","nameField","id","createTextNode","getMinutes","timeStamp","innerText","toLocaleTimeString","hour","minute","clientLog","pickchar","ccharacter","sendCharacter","emo","toggleshout","estring","window","String","hash","charCodeAt"],"mappings":"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","file":"client.b.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n","/*\r\n * Glorious webAO\r\n * made by sD, refactored by oldmud0\r\n * credits to aleks for original idea and source\r\n*/\r\n\r\nlet queryDict = {};\r\nlocation.search.substr(1).split(\"&\").forEach(function(item) {\r\n\tqueryDict[item.split(\"=\")[0]] = item.split(\"=\")[1]\r\n});\r\n\r\n/* Server magic */\r\n\r\nconst serverIP = queryDict.ip;\r\nlet mode = queryDict.mode;\r\n\r\nconst AO_HOST = queryDict.asset || \"http://assets.aceattorneyonline.com/base/\";\r\nconst MUSIC_HOST = AO_HOST + \"sounds/music/\";\r\nconst BAR_WIDTH = 90;\r\nconst BAR_HEIGHT = 20;\r\nconst CHAR_SELECT_WIDTH = 8;\r\nconst UPDATE_INTERVAL = 65;\r\n\r\nlet oldLoading = false;\r\nif (/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i.test(navigator.userAgent)) {\r\n\toldLoading = true;\r\n}\r\n\r\nlet selectedShout = 0;\r\nlet lastICMessageTime = new Date(0);\r\n\r\nclass Client {\r\n\tconstructor(address) {\r\n\t\tthis.serv = new WebSocket(\"ws://\" + address);\r\n\r\n\t\tthis.serv.onopen    = (evt) => this.onOpen(evt);\r\n\t\tthis.serv.onclose   = (evt) => this.onClose(evt);\r\n\t\tthis.serv.onmessage = (evt) => this.onMessage(evt);\r\n\t\tthis.serv.onerror   = (evt) => this.onError(evt);\r\n\r\n\t\tthis.playerID = 1;\r\n\t\tthis.charID = -1;\r\n\r\n\t\tthis.chars = [];\r\n\t\tthis.emotes = [];\r\n\r\n\t\tthis.selectedEmote = -1;\r\n\r\n\t\tthis.checkUpdater = null;\r\n\r\n\t\t// Only used for RMC/`music` packets, not EM/SM/MC packets.\r\n\t\tthis.musicList = Object();\r\n\r\n\t\tthis.handlers = {\r\n\t\t\t\"MS\":         (args) => this.handleMS(args),\r\n\t\t\t\"CT\":         (args) => this.handleCT(args),\r\n\t\t\t\"MC\":         (args) => this.handleMC(args),\r\n\t\t\t\"RMC\":        (args) => this.handleRMC(args),\r\n\t\t\t\"CI\":         (args) => this.handleCI(args),\r\n\t\t\t\"SC\":         (args) => this.handleSC(args),\r\n\t\t\t\"EI\":         (args) => this.handleEI(args),\r\n\t\t\t\"EM\":         (args) => this.handleEM(args),\r\n\t\t\t\"SM\":         (args) => this.handleSM(args),\r\n\t\t\t\"BD\":         (args) => this.handleBD(args),\r\n\t\t\t\"music\":      (args) => this.handlemusic(args),\r\n\t\t\t\"DONE\":       (args) => this.handleDONE(args),\r\n\t\t\t\"BN\":         (args) => this.handleBN(args),\r\n\t\t\t\"NBG\":        (args) => this.handleNBG(args),\r\n\t\t\t\"HP\":         (args) => this.handleHP(args),\r\n\t\t\t\"ID\":         (args) => this.handleID(args),\r\n\t\t\t\"PN\":         (args) => this.handlePN(args),\r\n\t\t\t\"SI\":         (args) => this.handleSI(args),\r\n\t\t\t\"CharsCheck\": (args) => this.handleCharsCheck(args),\r\n\t\t\t\"PV\":         (args) => this.handlePV(args),\r\n\t\t\t\"CHECK\":      (args) => {}\r\n\t\t}\r\n\r\n\t\tthis._lastTimeICReceived = new Date(0);\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the current player's character.\r\n\t */\r\n\tme() {\r\n\t\treturn this.chars[this.charID];\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the player's currently selected emote.\r\n\t */\r\n\tmyEmote() {\r\n\t\treturn this.emotes[this.selectedEmote];\r\n\t}\r\n\r\n\t/**\r\n\t * Sends an out-of-character chat message.\r\n\t * @param {string} message the message to send\r\n\t */\r\n\tsendOOC(message) {\r\n\t\tthis.serv.send(`CT#web${this.playerID}#${escapeChat(message)}#%`);\r\n\t}\r\n\r\n\t/**\r\n\t * Sends an in-character chat message.\r\n\t * @param {string} speaking who is speaking\r\n\t * @param {string} name the name of the current character\r\n\t * @param {string} silent whether or not it's silent\r\n\t * @param {string} message the message to be sent\r\n\t * @param {string} side the name of the side in the background\r\n\t * @param {string} ssfxname the name of the sound effect\r\n\t * @param {string} zoom whether or not to zoom\r\n\t * @param {string} ssfxdelay the delay (in milliseconds) to play the sound effect\r\n\t * @param {string} objection the number of the shout to play\r\n\t */\r\n\tsendIC(speaking, name, silent, message, side, ssfxname, zoom, ssfxdelay, objection) {\r\n\t\tthis.serv.send(\r\n\t\t\t`MS#chat#${speaking}#${name}#${silent}` +\r\n\t\t\t`#${escapeChat(message)}#${side}#${ssfxname}#${zoom}` +\r\n\t\t\t`#${this.charID}#${ssfxdelay}#${selectedShout}#0#0#0#0#%`\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Requests to change the music to the specified track.\r\n\t * @param {string} track the track ID\r\n\t */\r\n\tsendMusicChange(track) {\r\n\t\tthis.serv.send(`MC#${track}#${this.charID}#%`);\r\n\t}\r\n\r\n\t/**\r\n\t * Requests to leave the room and free the character slot.\r\n\t * \r\n\t * Note: This packet is undocumented. It is not implemented by\r\n\t * either the AO2 client or tsuserver.\r\n\t */\r\n\tsendLeaveRoom() {\r\n\t\tthis.serv.send(\"FC#%\");\r\n\t}\r\n\r\n\t/**\r\n\t * Begins the handshake process by sending an identifier\r\n\t * to the server.\r\n\t */\r\n\tjoinServer() {\r\n\t\tthis.serv.send(`HI#${navigator.userAgent.hashCode()}#%`);\r\n\t\tthis.serv.send(\"ID#webAO#2.4.5#%\");\r\n\t\tthis.checkUpdater = setInterval(() => this.sendCheck(), 5000);\r\n\t}\r\n\r\n\t/**\r\n\t * Requests to play as a specified character.\r\n\t * @param {number} character the character ID\r\n\t */\r\n\tsendCharacter(character) {\r\n\t\tthis.serv.send(`CC#${this.playerID}#${character}#web#%`);\r\n\t}\r\n\r\n\t/**\r\n\t * Requests to select a music track.\r\n\t * @param {number?} song the song to be played\r\n\t */\r\n\tsendMusic(song) {\r\n\t\tthis.serv.send(`MC#${song}`);\r\n\t}\r\n\r\n\t/**\r\n\t * Sends a keepalive packet.\r\n\t */\r\n\tsendCheck() {\r\n\t\tthis.serv.send(`CH#${this.charID}#%`);\r\n\t}\r\n\r\n\t/**\r\n\t * Triggered when a connection is established to the server.\r\n\t */\r\n\tonOpen(e) {\r\n\t\t// XXX: Why does watching mean just SITTING there and doing nothing?\r\n\t\tif (mode === \"watch\") {\r\n\t\t\tdocument.getElementById(\"client_loading\").style.display = \"none\";\r\n\t\t\tdocument.getElementById(\"client_charselect\").style.display = \"none\";\r\n\t\t} else {\r\n\t\t\tclient.joinServer();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Triggered when the connection to the server closes.\r\n\t * @param {CloseEvent} e\r\n\t */\r\n\tonClose(e) {\r\n\t\tconsole.error(`The connection was closed: ${e.reason} (${e.code})`);\r\n\t\tif (e.code !== 1001) {\r\n\t\t\tdocument.getElementById(\"client_error\").style.display = \"block\";\r\n\t\t\tdocument.getElementById(\"error_id\").textContent = e.code;\r\n\t\t\tthis.cleanup();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Triggered when a packet is received from the server.\r\n\t * @param {MessageEvent} e\r\n\t */\r\n\tonMessage(e) {\r\n\t\tlet msg = e.data;\r\n\t\tconsole.debug(msg);\r\n\t\tlet lines = msg.split('%');\r\n\t\tlet args = lines[0].split('#');\r\n\t\tlet header = args[0];\r\n\t\tlet handler = this.handlers[header];\r\n\t\tif (typeof handler !== \"undefined\") {\r\n\t\t\thandler(args);\r\n\t\t} else {\r\n\t\t\tconsole.warn(`Invalid packet header ${header}`);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Triggered when an network error occurs.\r\n\t * @param {ErrorEvent} e \r\n\t */\r\n\tonError(e) {\r\n\t\tconsole.error(`A network error occurred: ${e.reason} (${e.code})`);\r\n\t\tdocument.getElementById(\"client_error\").style.display = \"block\";\r\n\t\tdocument.getElementById(\"error_id\").textContent = e.code;\r\n\t\tthis.cleanup();\r\n\t}\r\n\r\n\tcleanup() {\r\n\t\ttry {\r\n\t\t\tthis.serv.close(1001);\r\n\t\t} catch (e) {\r\n\t\t\t// I don't care if this errors\r\n\t\t}\r\n\t\tclearInterval(this.checkUpdater);\r\n\t}\r\n\r\n\t/**\r\n\t * Handles an in-character chat message.\r\n\t * @param {*} args packet arguments\r\n\t */\r\n\thandleMS(args) {\r\n\t\t// TODO: this if-statement might be a bug.\r\n\t\tif (args[4] != viewport.chatmsg.content) {\r\n\t\t\tdocument.getElementById(\"client_inner_chat\").innerHTML = \"\";\r\n\t\t\tlet chatmsg = {\r\n\t\t\t\tpre: escape(args[2]),\r\n\t\t\t\tcharacter: -1, // Will do a linear search\r\n\t\t\t\tpreanim: escape(args[2]), // XXX: why again?\r\n\t\t\t\tnameplate: args[3], // TODO: parse INI to get this info\r\n\t\t\t\tname: args[3],\r\n\t\t\t\tspeaking: \"(b)\" + escape(args[4]),\r\n\t\t\t\tsilent: \"(a)\" + escape(args[4]),\r\n\t\t\t\tcontent: args[5],\r\n\t\t\t\tside: args[6],\r\n\t\t\t\tsound: escape(args[7]),\r\n\t\t\t\ttype: args[8],\r\n\t\t\t\t// charid: args[9],\r\n\t\t\t\tsnddelay: args[10],\r\n\t\t\t\tobjection: args[11],\r\n\t\t\t\tevidence: args[12],\r\n\t\t\t\t// flip: args[13],\r\n\t\t\t\tflash: args[14],\r\n\t\t\t\tcolor: args[15],\r\n\t\t\t\tisnew: true,\r\n\t\t\t};\r\n\r\n\t\t\t// The dreaded linear search...\r\n\t\t\tfor (let i = 0; i < this.chars.length; i++) {\r\n\t\t\t\tif (this.chars[i].name == args[3]) {\r\n\t\t\t\t\tchatmsg.character = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (chatmsg.character == this.charID) {\r\n\t\t\t\tresetICParams();\r\n\t\t\t}\r\n\r\n\t\t\tviewport.say(chatmsg);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles an out-of-character chat message.\r\n\t * @param {Array} args packet arguments\r\n\t */\r\n\thandleCT(args) {\r\n\t\tconst oocLog = document.getElementById(\"client_ooclog\");\r\n\t\toocLog.innerHTML += `${args[1]}: ${args[2]}\\r\\n`;\r\n\t\tif (oocLog.scrollTop > oocLog.scrollHeight - 60) {\r\n\t\t\toocLog.scrollTop = oocLog.scrollHeight;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles a music change to an arbitrary resource.\r\n\t * @param {Array} args packet arguments\r\n\t */\r\n\thandleMC(args) {\r\n\t\tconst music = viewport.music;\r\n\t\tmusic.pause();\r\n\t\tmusic.src = MUSIC_HOST + args[1];\r\n\t\tmusic.play();\r\n\t\tif (args[2] >= 0) {\r\n\t\t\tlet musicname = this.chars[args[2]].name;\r\n\t\t\tappendICLog(`${musicname} changed music to ${args[1]}`);\r\n\t\t} else {\r\n\t\t\tappendICLog(`The music was changed to ${args[1]}`);\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles a music change to an arbitrary resource, with an offset in seconds.\r\n\t * @param {Array} args packet arguments\r\n\t */\r\n\thandleRMC(args) {\r\n\t\tviewport.music.pause();\r\n\t\tviewport.music = new Audio(this.musicList[args[1]]);\r\n\t\tconst music = viewport.music;\r\n\t\t// Music offset + drift from song loading\r\n\t\tmusic.totime = args[1];\r\n\t\tmusic.offset = new Date().getTime() / 1000;\r\n\t\tmusic.addEventListener('loadedmetadata', function() {\r\n\t\t\tmusic.currentTime += parseFloat(music.totime + (new Date().getTime() / 1000 - music.offset)).toFixed(3);\r\n\t\t\tmusic.play();\r\n\t\t}, false);\r\n\t}\r\n\r\n\t/**\r\n\t * Handles incoming character information, bundling multiple characters\r\n\t * per packet.\r\n\t * @param {Array} args packet arguments\r\n\t */\r\n\thandleCI(args) {\r\n\t\tdocument.getElementById(\"client_loadingtext\").innerHTML = \"Loading Character \" + args[1];\r\n\t\tthis.serv.send(\"AN#\" + ((args[1] / 10) + 1) + \"#%\");\r\n\t\tfor (let i = 2; i < args.length - 1; i++) {\r\n\t\t\tif (i % 2 == 0) {\r\n\t\t\t\tlet chargs = args[i].split(\"&\");\r\n\t\t\t\tthis.chars[args[i - 1]] = {\r\n\t\t\t\t\t\"name\": chargs[0],\r\n\t\t\t\t\t\"desc\": chargs[1],\r\n\t\t\t\t\t\"evidence\": chargs[3],\r\n\t\t\t\t\t\"icon\": AO_HOST + \"characters/\" + escape(chargs[0]) + \"/char_icon.png\"\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles incoming character information, containing only one character\r\n\t * per packet.\r\n\t * @param {Array} args packet arguments\r\n\t */\r\n\thandleSC(args) {\r\n\t\tdocument.getElementById(\"client_loadingtext\").innerHTML = \"Loading Characters\";\r\n\t\tfor (let i = 1; i < args.length - 1; i++) {\r\n\t\t\tlet chargs = args[i].split(\"&\");\r\n\t\t\tthis.chars[i - 1] = {\r\n\t\t\t\t\"name\": chargs[0],\r\n\t\t\t\t\"desc\": chargs[1],\r\n\t\t\t\t\"evidence\": chargs[3],\r\n\t\t\t\t\"icon\": AO_HOST + \"characters/\" + escape(chargs[0]) + \"/char_icon.png\"\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.serv.send(\"RM#%\");\r\n\t}\r\n\r\n\t/**\r\n\t * Handles incoming evidence information, containing only one evidence\r\n\t * item per packet.\r\n\t * \r\n\t * Mostly unimplemented in webAO.\r\n\t * @param {Array} args packet arguments\r\n\t */\r\n\thandleEI(args) {\r\n\t\tdocument.getElementById(\"client_loadingtext\").innerHTML = \"Loading Evidence \" + args[1];\r\n\t\t//serv.send(\"AE#\" + (args[1] + 1) + \"#%\");\r\n\t\tthis.serv.send(\"RM#%\");\r\n\t}\r\n\r\n\t/**\r\n\t * Handles incoming music information, containing multiple entries\r\n\t * per packet.\r\n\t * @param {Array} args packet arguments\r\n\t */\r\n\thandleEM(args) {\r\n\t\tdocument.getElementById(\"client_loadingtext\").innerHTML = \"Loading Music \" + args[1];\r\n\t\tthis.serv.send(\"AM#\" + ((args[1] / 10) + 1) + \"#%\");\r\n\t\tlet hmusiclist = document.getElementById(\"client_musiclist\");\r\n\t\tfor (let i = 2; i < args.length - 1; i++) {\r\n\t\t\tif (i % 2 == 0) {\r\n\t\t\t\tlet newentry = document.createElement(\"OPTION\");\r\n\t\t\t\tnewentry.text = args[i];\r\n\t\t\t\thmusiclist.options.add(newentry);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles incoming music information, containing only one entry\r\n\t * per packet.\r\n\t * @param {Array} args packet arguments\r\n\t */\r\n\thandleSM(args) {\r\n\t\tdocument.getElementById(\"client_loadingtext\").innerHTML = \"Loading Music \";\r\n\t\tlet hmusiclist = document.getElementById(\"client_musiclist\");\r\n\t\tfor (let i = 1; i < args.length - 1; i++) {\r\n\t\t\tlet newentry = document.createElement(\"OPTION\");\r\n\t\t\tnewentry.text = args[i];\r\n\t\t\thmusiclist.options.add(newentry);\r\n\t\t}\r\n\t\tthis.serv.send(\"RD#%\");\r\n\t}\r\n\r\n/**\r\n\t * Handles the banned packet\r\n\t * @param {Array} args packet arguments\r\n\t */\r\n\thandleBD(args) {\r\n\t\tdocument.getElementById(\"client_loadingtext\").innerHTML = \"Banned: \" + args[1];\r\n\t}\r\n\r\n\t/**\r\n\t * Handles incoming music information, containing all entries\r\n\t * in the same packet.\r\n\t * @param {Array} args packet arguments\r\n\t */\r\n\thandlemusic(args) {\r\n\t\tfor (let i = 0; i < args.length / 2; i++) {\r\n\t\t\tthis.musicList[args[2 * i]] = args[2 * i + 1];\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles the handshake completion packet, meaning the player\r\n\t * is ready to select a character.\r\n\t * \r\n\t * @param {Array} args packet arguments\r\n\t */\r\n\thandleDONE(args) {\r\n\t\tdocument.getElementById(\"client_loading\").style.display = \"none\";\r\n\t\tdocument.getElementById(\"client_charselect\").style.display = \"block\";\r\n\t}\r\n\r\n\t/**\r\n\t * Handles a background change.\r\n\t * @param {Array} args packet arguments\r\n\t */\r\n\thandleBN(args) {\r\n\t\tviewport.bgname = escape(args[1]);\r\n\t}\r\n\r\n\thandleNBG(args) {\r\n\t\t// TODO (set by sD)\r\n\t}\r\n\r\n\t/**\r\n\t * Handles a change in the health bars' states.\r\n\t * @param {Array} args packet arguments\r\n\t */\r\n\thandleHP(args) {\r\n\t\t// TODO (set by sD)\r\n\t\t// Also, this is broken.\r\n\t\tif (args[1] == 1) {\r\n\t\t\tdocument.getElementById(\"client_defense_hp\").style.clip = \"rect(0px,\" + BAR_WIDTH * args[2] / 10 + \"px,\" + BAR_HEIGHT + \"px,0px)\";\r\n\t\t} else {\r\n\t\t\tdocument.getElementById(\"client_prosecutor_hp\").style.clip = \"rect(0px,\" + BAR_WIDTH * args[2] / 10 + \"px,\" + BAR_HEIGHT + \"px,0px)\";\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Handles the issuance of a player ID by the server.\r\n\t * @param {Array} args packet arguments\r\n\t */\r\n\thandleID(args) {\r\n\t\tthis.playerID = args[1];\r\n\t}\r\n\r\n\thandlePN(args) {\r\n\t\tthis.serv.send(\"askchaa#%\");\r\n\t}\r\n\r\n\t/**\r\n\t * Received when the server announces its server info,\r\n\t * but we use it as a cue to begin retrieving characters.\r\n\t * @param {Array} args packet arguments\r\n\t */\r\n\thandleSI(args) {\r\n\t\tif (oldLoading) {\r\n\t\t\tthis.serv.send(\"askchar2#%\");\r\n\t\t} else {\r\n\t\t\tthis.serv.send(\"RC#%\");\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Handles the list of all used and vacant characters.\r\n\t * @param {Array} args packet arguments\r\n\t */\r\n\thandleCharsCheck(args) {\r\n\t\tdocument.getElementById(\"client_chartable\").innerHTML = \"\";\r\n\t\tfor (let i = 0; i < this.chars.length; i++) {\r\n\t\t\tif (i % CHAR_SELECT_WIDTH == 0) {\r\n\t\t\t\tvar tr = document.createElement('TR');\r\n\t\t\t}\r\n\t\t\tlet td = document.createElement('TD');\r\n\t\t\tlet icon_chosen;\r\n\t\t\tlet thispick = this.chars[i].icon;\r\n\t\t\tif (args[i + 1] == \"-1\") {\r\n\t\t\t\ticon_chosen = \" dark\";\r\n\t\t\t} else {\r\n\t\t\t\ticon_chosen = \"\";\r\n\t\t\t}\r\n\t\t\ttd.innerHTML = `<img class='demothing${icon_chosen}' id='demo_${i}' ` +\r\n\t\t\t\t`src='${thispick}' alt='${this.chars[i].name}' onclick='pickchar(${i})' ` +\r\n\t\t\t\t`onerror='demoError(this);'>`;\r\n\t\t\ttr.appendChild(td);\r\n\t\t\tif (i % CHAR_SELECT_WIDTH == 0) {\r\n\t\t\t\tdocument.getElementById(\"client_chartable\").appendChild(tr);\r\n\t\t\t}\r\n\t\t}\r\n\t\tchangeBackground(\"def\");\r\n\t}\r\n\r\n\t/**\r\n\t * Handles the server's assignment of a character for the player to use.\r\n\t * @param {Array} args packet arguments\r\n\t */\r\n\thandlePV(args) {\r\n\t\tthis.charID = args[3];\r\n\t\tdocument.getElementById(\"client_charselect\").style.display = \"none\";\r\n\t\tlet me = this.me();\r\n\t\tlet emotes = this.emotes;\r\n\t\tlet xhr = new XMLHttpRequest();\r\n\t\txhr.open('GET', AO_HOST + 'characters/' + escape(this.me().name) + '/char.ini', true);\r\n\t\txhr.responseType = 'text';\r\n\t\txhr.onload = function (e) {\r\n\t\t\tif (this.status == 200) {\r\n\t\t\t\tlet linifile = this.responseText;\r\n\t\t\t\tlet pinifile = INI.parse(linifile);\r\n\t\t\t\tme.side = pinifile.Options.side;\r\n\t\t\t\tfor (let i = 1; i < pinifile.Emotions.number; i++) {\r\n\t\t\t\t\tlet emoteinfo = pinifile.Emotions[i].split('#');\r\n\t\t\t\t\tlet esfx = \"0\";\r\n\t\t\t\t\tlet esfxd = \"0\";\r\n\t\t\t\t\tif (typeof pinifile.SoundN !== 'undefined') {\r\n\t\t\t\t\t\tesfx = pinifile.SoundN[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (typeof pinifile.SoundT !== 'undefined') {\r\n\t\t\t\t\t\tesfxd = pinifile.SoundT[i];\r\n\t\t\t\t\t}\r\n\t\t\t\t\temotes[i] = {\r\n\t\t\t\t\t\tdesc: emoteinfo[0],\r\n\t\t\t\t\t\tspeaking: emoteinfo[1],\r\n\t\t\t\t\t\tsilent: emoteinfo[2],\r\n\t\t\t\t\t\tzoom: emoteinfo[3],\r\n\t\t\t\t\t\tsfx: esfx,\r\n\t\t\t\t\t\tsfxdelay: esfxd,\r\n\t\t\t\t\t\tbutton_off: AO_HOST + 'characters/' + escape(me.name) + '/emotions/button' + i + '_off.png',\r\n\t\t\t\t\t\tbutton_on: AO_HOST + 'characters/' + escape(me.name) + '/emotions/button' + i + '_on.png'\r\n\t\t\t\t\t};\r\n\t\t\t\t\tdocument.getElementById(\"client_emo\").innerHTML += \"<img src='\" + emotes[i].button_off + \"' id='emo_\" + i + \"' alt='\" + emotes[i].desc + \"' class='client_button' onclick='pickemotion(\" + i + \")'>\";\r\n\t\t\t\t}\r\n\t\t\t\tpickemotion(1);\r\n\t\t\t}\r\n\t\t};\r\n\t\txhr.send();\r\n\t}\r\n}\r\n\r\nclass Viewport {\r\n\tconstructor() {\r\n\t\tthis.textnow = \"\";\r\n\t\tthis.chatmsg = {\r\n\t\t\t\"isnew\": false,\r\n\t\t\t\"content\": \"\",\r\n\t\t\t\"objection\": \"0\",\r\n\t\t\t\"sound\": \"\",\r\n\t\t\t\"startspeaking\": false,\r\n\t\t\t\"side\": null,\r\n\t\t\t\"color\": \"0\",\r\n\t\t\t\"snddelay\": 0\r\n\t\t};\r\n\t\tthis.blip = new Audio(AO_HOST + 'sounds/general/sfx-blipmale.wav');\r\n\t\tthis.blip.volume = 0.5;\r\n\r\n\t\t// Allocate multiple blip audio channels to make blips less jittery\r\n\r\n\t\t// TODO: read blip type (\"gender\") from ini\r\n\t\tthis.blipChannels = new Array(6);\r\n\t\tfor (let i = 0; i < this.blipChannels.length; i++) {\r\n\t\t\tthis.blipChannels[i] = new Audio(AO_HOST + 'sounds/general/sfx-blipmale.wav');\r\n\t\t\tthis.blipChannels[i].volume = 0.5;\r\n\t\t}\r\n\t\tthis.currentBlipChannel = 0;\r\n\r\n\t\tthis.sfxaudio = new Audio(AO_HOST + 'sounds/general/sfx-blipmale.wav');\r\n\t\tthis.sfxplayed = 0;\r\n\r\n\t\tthis.music = new Audio();\r\n\t\tthis.music.play();\r\n\r\n\t\tthis.updater = null;\r\n\r\n\t\tthis.bgname = \"gs4\";\r\n\r\n\t\tthis.shoutTimer = 0;\r\n\t\tthis.textTimer = 0;\r\n\r\n\t\tthis._animating = false;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns whether or not the viewport is busy\r\n\t * performing a task (animating).\r\n\t */\r\n\tisAnimating() {\r\n\t\treturn this._animating;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the volume of the blip sound.\r\n\t * @param {number} volume\r\n\t */\r\n\tsetBlipVolume(volume) {\r\n\t\tfor (let i = 0; i < this.blipChannels.length; i++) {\r\n\t\t\tthis.blipChannels[i].volume = volume;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Returns the path which the background is located in.\r\n\t */\r\n\tbgFolder() {\r\n\t\treturn `${AO_HOST}background/${this.bgname}/`;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a new emote.\r\n\t * @param {object} chatmsg the new chat message\r\n\t */\r\n\tsay(chatmsg) {\r\n\t\tthis.chatmsg = chatmsg;\r\n\t\tappendICLog(chatmsg.content, chatmsg.nameplate);\r\n\t\tchangeBackground(chatmsg.side);\r\n\t\tthis.textnow = '';\r\n\t\tthis.sfxplayed = 0;\r\n\t\tthis.textTimer = 0;\r\n\t\tthis._animating = true;\r\n\t\tclearTimeout(this.updater);\r\n\t\tthis.updater = setTimeout(() => this.updateText(), UPDATE_INTERVAL);\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the chatbox based on the given text.\r\n\t * \r\n\t * XXX: This relies on a global variable `this.chatmsg`!\r\n\t */\r\n\tupdateText() {\r\n\t\tif (this.chatmsg.content.trim() == \"\") {\r\n\t\t\tdocument.getElementById(\"client_name\").style.display = \"none\";\r\n\t\t\tdocument.getElementById(\"client_chat\").style.display = \"none\";\r\n\t\t} else {\r\n\t\t\tdocument.getElementById(\"client_name\").style.display = \"block\";\r\n\t\t\tdocument.getElementById(\"client_chat\").style.display = \"block\";\r\n\t\t}\r\n\r\n\t\tif (this._animating) {\r\n\t\t\tthis.updater = setTimeout(() => this.updateText(), UPDATE_INTERVAL);\r\n\t\t}\r\n\r\n\t\tif (this.chatmsg.isnew) {\r\n\t\t\tconst shouts = {\r\n\t\t\t\t\"1\": \"holdit\",\r\n\t\t\t\t\"2\": \"takethat\",\r\n\t\t\t\t\"3\": \"objection\"\r\n\t\t\t};\r\n\r\n\t\t\tlet shout = shouts[this.chatmsg.objection];\r\n\t\t\tif (typeof shout !== \"undefined\") {\r\n\t\t\t\tdocument.getElementById(\"client_char\").src = AO_HOST + \"misc/\" + shout + \".gif\";\r\n\t\t\t\t(new Audio(`${AO_HOST}/characters/${this.chatmsg.name}/${shout}.wav`)).play();\r\n\t\t\t\tthis.shoutTimer = 800;\r\n\t\t\t} else {\r\n\t\t\t\tthis.shoutTimer = 0;\r\n\t\t\t}\r\n\r\n\t\t\tthis.chatmsg.isnew = false;\r\n\t\t\tthis.chatmsg.startspeaking = true;\r\n\t\t}\r\n\r\n\t\tif (this.textTimer >= this.shoutTimer) {\r\n\t\t\tif (this.chatmsg.startspeaking) {\r\n\t\t\t\tchangeBackground(this.chatmsg.side);\r\n\t\t\t\tdocument.getElementById(\"client_char\").src = AO_HOST + \"characters/\" + escape(this.chatmsg.name) + \"/\" + this.chatmsg.speaking + \".gif\";\r\n\t\t\t\tdocument.getElementById(\"client_name\").style.fontSize = (document.getElementById(\"client_name\").offsetHeight * 0.7) + \"px\";\r\n\t\t\t\tdocument.getElementById(\"client_chat\").style.fontSize = (document.getElementById(\"client_chat\").offsetHeight * 0.25) + \"px\";\r\n\t\t\t\tdocument.getElementById(\"client_name\").innerHTML = \"<p>\" + escapeHtml(this.chatmsg.nameplate) + \"</p>\";\r\n\r\n\t\t\t\tconst colors = {\r\n\t\t\t\t\t\"0\": \"#ffffff\",\r\n\t\t\t\t\t\"1\": \"#00ff00\",\r\n\t\t\t\t\t\"2\": \"#ff0000\",\r\n\t\t\t\t\t\"3\": \"#ffaa00\",\r\n\t\t\t\t\t\"4\": \"#0000ff\",\r\n\t\t\t\t\t\"5\": \"#ffff00\",\r\n\t\t\t\t\t\"6\": \"#aa00aa\"\r\n\t\t\t\t}\r\n\t\t\t\tlet stylecolor = \"color: \" + (colors[this.chatmsg.color] || \"#ffffff\");\r\n\t\t\t\tdocument.getElementById(\"client_inner_chat\").style = stylecolor;\r\n\t\t\t\tthis.chatmsg.startspeaking = false;\r\n\r\n\t\t\t\tif (this.textnow == this.chatmsg.content) {\r\n\t\t\t\t\tdocument.getElementById(\"client_char\").src = AO_HOST + \"characters/\" + escape(this.chatmsg.name) + \"/\" + this.chatmsg.silent + \".gif\";\r\n\t\t\t\t\tthis._animating = false;\r\n\t\t\t\t\tclearTimeout(this.updater);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (this.textnow != this.chatmsg.content) {\r\n\t\t\t\t\tif (this.chatmsg.content.charAt(this.textnow.length) != \" \") {\r\n\t\t\t\t\t\tthis.blipChannels[this.currentBlipChannel].play();\r\n\t\t\t\t\t\tthis.currentBlipChannel++;\r\n\t\t\t\t\t\tthis.currentBlipChannel %= this.blipChannels.length;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.textnow = this.chatmsg.content.substring(0, this.textnow.length + 1);\r\n\t\t\t\t\tdocument.getElementById(\"client_inner_chat\").innerHTML = this.textnow;\r\n\t\t\t\t\tif (this.textnow == this.chatmsg.content) {\r\n\t\t\t\t\t\tthis.textTimer = 0;\r\n\t\t\t\t\t\tthis._animating = false;\r\n\t\t\t\t\t\tdocument.getElementById(\"client_char\").src = AO_HOST + \"characters/\" + escape(this.chatmsg.name) + \"/\" + this.chatmsg.silent + \".gif\";\r\n\t\t\t\t\t\tclearTimeout(this.updater);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!this.sfxplayed && this.chatmsg.snddelay + this.shoutTimer >= this.textTimer) {\r\n\t\t\tthis.sfxaudio.pause();\r\n\t\t\tthis.sfxplayed = 1;\r\n\t\t\tif (this.chatmsg.sound != \"0\" && this.chatmsg.sound != \"1\") {\r\n\t\t\t\tthis.sfxaudio.src = AO_HOST + \"sounds/general/\" + escape(this.chatmsg.sound) + \".wav\";\r\n\t\t\t\tthis.sfxaudio.play();\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.textTimer = this.textTimer + UPDATE_INTERVAL;\r\n\t}\r\n}\r\n\r\nclass INI {\r\n\tstatic parse(data) {\r\n\t\tlet regex = {\r\n\t\t\tsection: /^\\s*\\[\\s*([^\\]]*)\\s*\\]\\s*$/,\r\n\t\t\tparam: /^\\s*([\\w\\.\\-\\_]+)\\s*=\\s*(.*?)\\s*$/,\r\n\t\t\tcomment: /^\\s*;.*$/\r\n\t\t};\r\n\t\tlet value = {};\r\n\t\tlet lines = data.split(/\\r\\n|\\r|\\n/);\r\n\t\tlet section = null;\r\n\t\tlines.forEach(function(line) {\r\n\t\t\tif (regex.comment.test(line)) {\r\n\t\t\t\treturn;\r\n\t\t\t} else if (line.length == 0) {\r\n\t\t\t\treturn;\r\n\t\t\t} else if (regex.param.test(line)) {\r\n\t\t\t\tlet match = line.match(regex.param);\r\n\t\t\t\tif (section) {\r\n\t\t\t\t\tvalue[section][match[1]] = match[2];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue[match[1]] = match[2];\r\n\t\t\t\t}\r\n\t\t\t} else if (regex.section.test(line)) {\r\n\t\t\t\tlet match = line.match(regex.section);\r\n\t\t\t\tvalue[match[1]] = {};\r\n\t\t\t\tsection = match[1];\r\n\t\t\t};\r\n\t\t});\r\n\t\treturn value;\r\n\t}\r\n}\r\n\r\n/**\r\n * Triggered when the Return key is pressed on the out-of-character chat input box.\r\n * @param {KeyboardEvent} event\r\n */\r\nexport function onOOCEnter(event) {\r\n\tif (event.keyCode == 13) {\r\n\t\tclient.sendOOC(document.getElementById(\"client_oocinputbox\").value);\r\n\t\tdocument.getElementById(\"client_oocinputbox\").value = \"\";\r\n\t}\r\n}\r\nwindow.onOOCEnter = onOOCEnter;\r\n\r\n/**\r\n * Triggered when the Return key is pressed on the in-character chat input box.\r\n * @param {KeyboardEvent} event\r\n */\r\nexport function onEnter(event) {\r\n\tif (event.keyCode == 13) {\r\n\t\tlet mychar = client.me();\r\n\t\tlet myemo = client.myEmote();\r\n\t\tlet ssfxname = \"0\";\r\n\t\tlet ssfxdelay = \"0\";\r\n\t\tif (document.getElementById(\"sendsfx\").checked) {\r\n\t\t\tssfxname = myemo.sfx;\r\n\t\t\tssfxdelay = myemo.sfxdelay;\r\n\t\t}\r\n\t\tclient.sendIC(myemo.speaking, mychar.name, myemo.silent, document.getElementById(\"client_inputbox\").value, mychar.side, ssfxname, myemo.zoom, ssfxdelay, selectedShout);\r\n\t}\r\n}\r\nwindow.onEnter = onEnter;\r\n\r\n/**\r\n * Resets the IC parameters for the player to enter a new chat message.\r\n * This should only be called when the player's previous chat message\r\n * was successfully sent/presented.\r\n */\r\nfunction resetICParams() {\r\n\tdocument.getElementById(\"client_inputbox\").value = \"\";\r\n\tif (selectedShout) {\r\n\t\tdocument.getElementById(\"button_\" + selectedShout).className = \"client_button\";\r\n\t\tselectedShout = 0;\r\n\t}\r\n}\r\n\r\n/**\r\n * Triggered when an item on the music list is clicked.\r\n * @param {MouseEvent} event\r\n */\r\nexport function musiclist_click(event) {\r\n\tlet playtrack = document.getElementById(\"client_musiclist\").value;\r\n\tclient.sendMusicChange(playtrack);\r\n}\r\nwindow.musiclist_click = musiclist_click;\r\n\r\n/**\r\n * Triggered by the music volume slider.\r\n */\r\nexport function changeMusicVolume() {\r\n\tviewport.music.volume = document.getElementById(\"client_mvolume\").value / 100;\r\n}\r\nwindow.changeMusicVolume = changeMusicVolume;\r\n\r\n/**\r\n * Triggered by the sound effect volume slider.\r\n */\r\nexport function changeSFXVolume() {\r\n\tviewport.sfxaudio.volume = document.getElementById(\"client_svolume\").value / 100;\r\n}\r\nwindow.changeSFXVolume = changeSFXVolume;\r\n\r\n/**\r\n * Triggered by the blip volume slider.\r\n */\r\nexport function changeBlipVolume() {\r\n\tviewport.setBlipVolume(document.getElementById(\"client_bvolume\").value / 100);\r\n}\r\nwindow.changeBlipVolume = changeBlipVolume;\r\n\r\n/**\r\n * Triggered when a character icon is clicked in the character selection menu.\r\n * @param {MouseEvent} event\r\n */\r\nexport function changeCharacter(event) {\r\n\tclient.sendLeaveRoom();\r\n\tdocument.getElementById(\"client_charselect\").style.display = \"block\";\r\n\tdocument.getElementById(\"client_emo\").innerHTML = \"\";\r\n}\r\nwindow.changeCharacter = changeCharacter;\r\n\r\n/**\r\n * Triggered when there was an error loading a character sprite.\r\n * @param {HTMLImageElement} image the element containing the missing image\r\n */\r\nexport function imgError(image) {\r\n\timage.onerror = \"\";\r\n\timage.src = \"/misc/placeholder.gif\";\r\n\treturn true;\r\n}\r\nwindow.imgError = imgError;\r\n\r\n/**\r\n * Triggered when there was an error loading a character icon.\r\n * @param {HTMLImageElement} image the element containing the missing image\r\n */\r\nexport function demoError(image) {\r\n\timage.onerror = \"\";\r\n\timage.src = \"/misc/placeholder.png\";\r\n\treturn true;\r\n}\r\nwindow.demoError = demoError;\r\n\r\n/**\r\n * Checks if an image exists at the specified URI.\r\n * @param {string} url the URI to be checked\r\n */\r\nfunction ImageExist(url) {\r\n\tvar img = new Image();\r\n\timg.src = url;\r\n\treturn img.height != 0;\r\n}\r\n\r\n/**\r\n * Changes the viewport background based on a given position.\r\n * \r\n * Valid positions: `def, pro, hld, hlp, wit, jud`\r\n * @param {string} position the position to change into\r\n */\r\nfunction changeBackground(position) {\r\n\tvar standname;\r\n\tlet bgfolder = viewport.bgFolder();\r\n\tdocument.getElementById(\"client_fg\").style.display = \"none\";\r\n\tdocument.getElementById(\"client_bench\").style.display = \"none\";\r\n\tswitch (position) {\r\n\t\tcase \"def\":\r\n\t\t\tdocument.getElementById(\"client_court\").src = bgfolder + \"defenseempty.png\"\r\n\t\t\tdocument.getElementById(\"client_bench\").style.display = \"block\";\r\n\t\t\tdocument.getElementById(\"client_bench\").src = bgfolder + \"defensedesk.png\"\r\n\t\t\tstandname = \"defense\";\r\n\t\t\tbreak;\r\n\t\tcase \"pro\":\r\n\t\t\tdocument.getElementById(\"client_court\").src = bgfolder + \"prosecutorempty.png\"\r\n\t\t\tdocument.getElementById(\"client_bench\").style.display = \"block\"\r\n\t\t\tdocument.getElementById(\"client_bench\").src = bgfolder + \"prosecutiondesk.png\"\r\n\t\t\tstandname = \"prosecution\";\r\n\t\t\tbreak;\r\n\t\tcase \"hld\":\r\n\t\t\tdocument.getElementById(\"client_court\").src = bgfolder + \"helperstand.png\"\r\n\t\t\tstandname = \"defense\";\r\n\t\t\tbreak;\r\n\t\tcase \"hlp\":\r\n\t\t\tdocument.getElementById(\"client_court\").src = bgfolder + \"prohelperstand.png\"\r\n\t\t\tstandname = \"prosecution\";\r\n\t\t\tbreak;\r\n\t\tcase \"wit\":\r\n\t\t\tdocument.getElementById(\"client_court\").src = bgfolder + \"witnessempty.png\"\r\n\t\t\tdocument.getElementById(\"client_bench\").style.display = \"block\"\r\n\t\t\tdocument.getElementById(\"client_bench\").src = bgfolder + \"estrado.png\"\r\n\t\t\tstandname = \"prosecution\";\r\n\t\t\tbreak;\r\n\t\tcase \"jud\":\r\n\t\t\tdocument.getElementById(\"client_court\").src = bgfolder + \"judgestand.png\"\r\n\t\t\tstandname = \"prosecution\";\r\n\t\t\tbreak;\r\n\t}\r\n\tif (viewport.chatmsg.type == 5) {\r\n\t\tdocument.getElementById(\"client_bench\").style.display = \"none\";\r\n\t\tdocument.getElementById(\"client_court\").src = AO_HOST + \"themes/default/\" + standname + \"_speedlines.gif\";\r\n\t}\r\n}\r\n\r\n/**\r\n * Triggered when the reconnect button is pushed.\r\n */\r\nexport function ReconnectButton() {\r\n\tclient.cleanup();\r\n\tclient = new Client(serverIP);\r\n\tif (client) {\r\n\t\tmode = \"join\"; // HACK: see client.onOpen\r\n\t\tdocument.getElementById(\"client_error\").style.display = \"none\";\r\n\t}\r\n}\r\nwindow.ReconnectButton = ReconnectButton;\r\n\r\n/**\r\n * Triggered when the retry button is pushed (during the loading process).\r\n */\r\nexport function RetryButton() {\r\n\tclient.joinServer();\r\n}\r\nwindow.RetryButton = RetryButton;\r\n\r\n/**\r\n * Appends a message to the in-character chat log.\r\n * @param {string} toadd the string to be added\r\n * @param {string} name the name of the sender\r\n */\r\nfunction appendICLog(toadd, name = \"\", time = new Date()) {\r\n\tconst entry = document.createElement(\"p\");\r\n\tconst nameField = document.createElement(\"span\");\r\n\tnameField.id = \"iclog_name\";\r\n\tnameField.appendChild(document.createTextNode(name));\r\n\tentry.appendChild(nameField);\r\n\tentry.appendChild(document.createTextNode(toadd));\r\n\r\n\t// Only put a timestamp if the minute has changed.\r\n\tif (lastICMessageTime.getMinutes() !== time.getMinutes()) {\r\n\t\tconst timeStamp = document.createElement(\"span\");\r\n\t\ttimeStamp.id = \"iclog_time\";\r\n\t\ttimeStamp.innerText = time.toLocaleTimeString(undefined, {\r\n\t\t\thour: \"numeric\",\r\n\t\t\tminute: \"2-digit\"\r\n\t\t});\r\n\t\tentry.appendChild(timeStamp);\r\n\t}\r\n\r\n\tconst clientLog = document.getElementById(\"client_log\");\r\n\tclientLog.appendChild(entry);\r\n\r\n\tif (clientLog.scrollTop > clientLog.scrollHeight - 600) {\r\n\t\tclientLog.scrollTop = clientLog.scrollHeight;\r\n\t}\r\n\r\n\tlastICMessageTime = new Date();\r\n}\r\n\r\n/**\r\n * Requests to play as a character.\r\n * @param {number} ccharacter the character ID; if this is a large number, then spectator is chosen instead.\r\n */\r\nexport function pickchar(ccharacter) {\r\n\tif (ccharacter < 1000) {\r\n\t\tclient.sendCharacter(ccharacter);\r\n\t} else {\r\n\t\t// Spectator\r\n\t\tdocument.getElementById(\"client_charselect\").style.display = \"none\";\r\n\t\tdocument.getElementById(\"client_inputbox\").style.display = \"none\";\r\n\t\tdocument.getElementById(\"client_emo\").style.display = \"none\";\r\n\t}\r\n}\r\nwindow.pickchar = pickchar;\r\n\r\n/**\r\n * Highlights and selects an emotion for in-character chat.\r\n * @param {string} emo the new emotion to be selected\r\n */\r\nexport function pickemotion(emo) {\r\n\tif (client.selectedEmote != -1) {\r\n\t\tdocument.getElementById(\"emo_\" + client.selectedEmote).src = client.myEmote().button_off;\r\n\t}\r\n\tclient.selectedEmote = emo\r\n\tdocument.getElementById(\"emo_\" + emo).src = client.myEmote().button_on;\r\n}\r\nwindow.pickemotion = pickemotion;\r\n\r\n/**\r\n * Highlights and selects a shout for in-character chat.\r\n * If the same shout button is selected, then the shout is canceled.\r\n * @param {string} shout the new shout to be selected\r\n */\r\nexport function toggleshout(shout) {\r\n\tif (shout == selectedShout) {\r\n\t\tdocument.getElementById(\"button_\" + shout).className = \"client_button\";\r\n\t\tselectedShout = 0;\r\n\t} else {\r\n\t\tdocument.getElementById(\"button_\" + shout).className = \"client_button dark\";\r\n\t\tif (selectedShout) {\r\n\t\t\tdocument.getElementById(\"button_\" + selectedShout).className = \"client_button\";\r\n\t\t}\r\n\t\tselectedShout = shout;\r\n\t}\r\n}\r\nwindow.toggleshout = toggleshout;\r\n\r\n/**\r\n * Escapes a string to be HTML-safe.\r\n * \r\n * XXX: This is unnecessary if we use `createTextNode` instead!\r\n * @param {string} unsafe an unsanitized string\r\n */\r\nfunction escapeHtml(unsafe) {\r\n\treturn unsafe\r\n\t\t.replace(/&/g, \"&amp;\")\r\n\t\t.replace(/</g, \"&lt;\")\r\n\t\t.replace(/>/g, \"&gt;\")\r\n\t\t.replace(/\"/g, \"&quot;\")\r\n\t\t.replace(/'/g, \"&#039;\");\r\n}\r\n\r\n/**\r\n * Escapes a string to AO1 escape codes.\r\n * @param {string} estring the string to be escaped\r\n */\r\nfunction escapeChat(estring) {\r\n\treturn estring\r\n\t\t.replace(/#/g, \"<pound>\")\r\n\t\t.replace(/&/g, \"<and>\")\r\n\t\t.replace(/%/g, \"<percent>\")\r\n\t\t.replace(/\\$/g, \"<dollar>\");\r\n}\r\n\r\n// TODO: Possibly safe to remove, since we are using a transpiler.\r\nif (typeof(String.prototype.trim) === \"undefined\")\r\n{\r\n    String.prototype.trim = function() \r\n    {\r\n        return String(this).replace(/^\\s+|\\s+$/g, '');\r\n    };\r\n}\r\n\r\n// Used for HDID calculation.\r\nString.prototype.hashCode = function() {\r\n\tvar hash = 0, i, chr;\r\n\tif (this.length === 0) return hash;\r\n\tfor (i = 0; i < this.length; i++) {\r\n\t  chr   = this.charCodeAt(i);\r\n\t  hash  = ((hash << 5) - hash) + chr;\r\n\t  hash |= 0; // Convert to 32bit integer\r\n\t}\r\n\treturn hash;\r\n};\r\n\r\n\r\n//\r\n// Client code\r\n//\r\n\r\nlet client = new Client(serverIP);\r\nlet viewport = new Viewport();\r\n"],"sourceRoot":""}