{"version":3,"file":"master.a862197f083e71acc723.bundle.js","mappings":"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","sources":["webpack://webao/./webAO/encoding.ts","webpack://webao/./webAO/master.ts","webpack://webao/webpack/bootstrap","webpack://webao/webpack/startup"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.prepChat = exports.decodeChat = exports.safeTags = exports.unescapeChat = exports.escapeChat = void 0;\n/**\n * Escapes a string to AO1 escape codes.\n * @param {string} estring the string to be escaped\n */\nfunction escapeChat(estring) {\n    return estring\n        .replaceAll(\"#\", \"<num>\")\n        .replaceAll(\"&\", \"<and>\")\n        .replaceAll(\"%\", \"<percent>\")\n        .replaceAll(\"$\", \"<dollar>\");\n}\nexports.escapeChat = escapeChat;\n/**\n * Unescapes a string to AO1 escape codes.\n * @param {string} estring the string to be unescaped\n */\nfunction unescapeChat(estring) {\n    return estring\n        .replaceAll(\"<num>\", \"#\")\n        .replaceAll(\"<and>\", \"&\")\n        .replaceAll(\"<percent>\", \"%\")\n        .replaceAll(\"<dollar>\", \"$\");\n}\nexports.unescapeChat = unescapeChat;\n/**\n * Escapes a string to be HTML-safe.\n *\n * XXX: This is unnecessary if we use `createTextNode` instead!\n * @param {string} unsafe an unsanitized string\n */\nfunction safeTags(unsafe) {\n    if (unsafe) {\n        return unsafe.replaceAll(\">\", \"＞\").replaceAll(\"<\", \"＜\");\n    }\n    return \"\";\n}\nexports.safeTags = safeTags;\n/**\n * Decodes text on client side.\n * @param {string} estring the string to be decoded\n */\nfunction decodeChat(estring) {\n    // Source: https://stackoverflow.com/questions/7885096/how-do-i-decode-a-string-with-escaped-unicode\n    return estring.replace(/\\\\u([\\d\\w]{1,})/gi, function (match, group) {\n        return String.fromCharCode(parseInt(group, 16));\n    });\n}\nexports.decodeChat = decodeChat;\n/**\n * XXX: a nasty hack made by gameboyprinter.\n * @param {string} msg chat message to prepare for display\n */\nfunction prepChat(msg) {\n    // TODO: make this less awful\n    return safeTags(unescapeChat(decodeChat(msg)));\n}\nexports.prepChat = prepChat;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar encoding_1 = require(\"./encoding\");\nvar clientVersion = process.env.npm_package_version;\n// const MASTERSERVER_IP = 'master.aceattorneyonline.com:27014';\nvar serverlist_domain = \"servers.aceattorneyonline.com\";\nvar protocol = window.location.protocol;\nvar serverlist_cache_key = \"masterlist\";\nvar servers = [];\nservers[-1] = {\n    name: \"Localhost\",\n    description: \"This is your computer on port 50001\",\n    ip: \"127.0.0.1\",\n    players: 0,\n    online: \"Localhost\",\n    ws_port: 50001,\n};\nfunction main() {\n    getServerlist().then(function (serverlist) {\n        processServerlist(serverlist);\n    });\n    addServer(servers[-1]);\n    processClientVersion(clientVersion);\n    getMasterVersion().then(function (masterVersion) {\n        processMasterVersion(masterVersion);\n    });\n}\nmain();\n// Fetches the serverlist from the masterserver\n// Returns a properly typed list of servers\nfunction getServerlist() {\n    return __awaiter(this, void 0, void 0, function () {\n        var url, response, data, serverlist, data_1, data_1_1, item, newServer;\n        var e_1, _a;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    url = \"\".concat(protocol, \"//\").concat(serverlist_domain, \"/servers\");\n                    return [4 /*yield*/, fetch(url)];\n                case 1:\n                    response = _b.sent();\n                    if (!response.ok) {\n                        console.error(\"Bad status code from masterserver. status: \".concat(response.status, \", body: \").concat(response.body));\n                        document.getElementById(\"ms_error\").style.display = \"block\";\n                        // If we get a bad status code, try to use the cached serverlist\n                        return [2 /*return*/, getCachedServerlist()];\n                    }\n                    return [4 /*yield*/, response.json()];\n                case 2:\n                    data = _b.sent();\n                    serverlist = [];\n                    try {\n                        for (data_1 = __values(data), data_1_1 = data_1.next(); !data_1_1.done; data_1_1 = data_1.next()) {\n                            item = data_1_1.value;\n                            if (!item.name) {\n                                console.warn(\"Server \".concat(item, \" has no name, skipping\"));\n                                continue;\n                            }\n                            if (!item.ip) {\n                                console.warn(\"Server \".concat(item.name, \" has no ip, skipping\"));\n                                continue;\n                            }\n                            if (!item.description) {\n                                console.warn(\"Server \".concat(item.name, \" has no description, skipping\"));\n                                continue;\n                            }\n                            newServer = {\n                                name: item.name,\n                                description: item.description,\n                                ip: item.ip,\n                                players: item.players || 0,\n                                online: \"Players: \".concat(item.players),\n                            };\n                            if (item.ws_port) {\n                                newServer.ws_port = item.ws_port;\n                            }\n                            if (item.wss_port) {\n                                newServer.wss_port = item.wss_port;\n                            }\n                            // if none of ws_port or wss_port are defined, skip\n                            // Note that this is not an error condition, as many servers only has port (TCP) enabled\n                            // Which means they don't support webAO\n                            if (!newServer.ws_port && !newServer.wss_port) {\n                                continue;\n                            }\n                            serverlist.push(newServer);\n                        }\n                    }\n                    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n                    finally {\n                        try {\n                            if (data_1_1 && !data_1_1.done && (_a = data_1.return)) _a.call(data_1);\n                        }\n                        finally { if (e_1) throw e_1.error; }\n                    }\n                    // Always cache the result when we get it\n                    localStorage.setItem(serverlist_cache_key, JSON.stringify(serverlist));\n                    return [2 /*return*/, serverlist];\n            }\n        });\n    });\n}\nfunction getCachedServerlist() {\n    // If it's not in the cache, return an empty list\n    var cached = localStorage.getItem(serverlist_cache_key) || \"[]\";\n    return JSON.parse(cached);\n}\n// Constructs the client URL robustly, independent of domain and path\nfunction constructClientURL(protocol) {\n    var clientURL = new URL(window.location.href);\n    // Use the given protocol\n    clientURL.protocol = protocol;\n    // Remove the last part of the pathname (e.g., \"index.html\")\n    var pathname = clientURL.pathname;\n    var parts = pathname.split(\"/\");\n    parts.pop();\n    // Reconstruct the pathname\n    clientURL.pathname = parts.join(\"/\");\n    // If clientURL.pathname does not end with a slash, add one\n    if (clientURL.pathname[clientURL.pathname.length - 1] !== \"/\") {\n        clientURL.pathname += \"/\";\n    }\n    clientURL.pathname += \"client.html\";\n    return clientURL.href;\n}\nfunction addServer(server) {\n    var ws_port = 0;\n    var ws_protocol = \"\";\n    var http_protocol = \"\";\n    if (server.ws_port) {\n        ws_port = server.ws_port;\n        ws_protocol = \"ws\";\n        http_protocol = \"http\";\n    }\n    if (server.wss_port && !window.navigator.userAgent.includes(\"Nintendo\")) {\n        ws_port = server.wss_port;\n        ws_protocol = \"wss\";\n        http_protocol = \"https\";\n    }\n    if (ws_port === 0 || ws_protocol === \"\" || http_protocol === \"\") {\n        console.warn(\"Server \".concat(server.name, \" has no websocket port, skipping\"));\n        return;\n    }\n    var clientURL = constructClientURL(http_protocol);\n    var connect = \"\".concat(ws_protocol, \"://\").concat(server.ip, \":\").concat(ws_port);\n    var serverName = server.name;\n    var fullClientWatchURL = \"\".concat(clientURL, \"?mode=watch&connect=\").concat(connect, \"&serverName=\").concat(serverName);\n    var fullClientJoinURL = \"\".concat(clientURL, \"?mode=join&connect=\").concat(connect, \"&serverName=\").concat(serverName);\n    servers.push(server);\n    document.getElementById(\"masterlist\").innerHTML +=\n        \"<details name=\\\"servers\\\">\" +\n            \"<summary><p>\".concat((0, encoding_1.safeTags)(server.name), \" (\").concat(server.players, \")</p>\") +\n            \"<a class=\\\"button\\\" href=\\\"\".concat(fullClientJoinURL, \"\\\" target=\\\"_blank\\\">Join</a>\") +\n            \"<a class=\\\"button\\\" href=\\\"\".concat(fullClientWatchURL, \"\\\" target=\\\"_blank\\\">Watch</a></summary>\") +\n            \"<p>\".concat((0, encoding_1.safeTags)(server.description), \"</p>\") +\n            \"</details>\";\n}\nfunction processServerlist(serverlist) {\n    for (var i = 0; i < serverlist.length; i++) {\n        addServer(serverlist[i]);\n    }\n}\nfunction getMasterVersion() {\n    return __awaiter(this, void 0, void 0, function () {\n        var url, response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    url = \"\".concat(protocol, \"//\").concat(serverlist_domain, \"/version\");\n                    return [4 /*yield*/, fetch(url)];\n                case 1:\n                    response = _a.sent();\n                    if (!response.ok) {\n                        console.error(\"Bad status code from masterserver version check. status: \".concat(response.status, \", body: \").concat(response.body));\n                        return [2 /*return*/, \"Unknown\"];\n                    }\n                    return [4 /*yield*/, response.text()];\n                case 2: return [2 /*return*/, _a.sent()];\n            }\n        });\n    });\n}\nfunction processClientVersion(data) {\n    document.getElementById(\"clientinfo\").innerHTML = \"Client version: \".concat(data);\n}\nfunction processMasterVersion(data) {\n    document.getElementById(\"serverinfo\").innerHTML =\n        \"Master server version: \".concat(data);\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(924);\n"],"names":["unescapeChat","estring","replaceAll","safeTags","unsafe","decodeChat","replace","match","group","String","fromCharCode","parseInt","Object","defineProperty","exports","value","prepChat","escapeChat","msg","__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","g","_","label","sent","trys","ops","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","__values","o","s","m","i","encoding_1","serverlist_domain","protocol","window","location","serverlist_cache_key","servers","addServer","server","ws_port","ws_protocol","http_protocol","wss_port","navigator","userAgent","includes","clientURL","URL","href","parts","pathname","split","join","constructClientURL","connect","concat","ip","serverName","name","fullClientWatchURL","fullClientJoinURL","document","getElementById","innerHTML","players","description","console","warn","online","url","response","data","serverlist","data_1","data_1_1","item","newServer","e_1","_a","_b","fetch","ok","json","error","status","style","display","cached","localStorage","getItem","JSON","parse","e_1_1","return","setItem","stringify","getServerlist","processServerlist","text","getMasterVersion","masterVersion","processMasterVersion","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","module","__webpack_modules__"],"sourceRoot":""}