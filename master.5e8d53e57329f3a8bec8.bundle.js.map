{"version":3,"file":"master.5e8d53e57329f3a8bec8.bundle.js","mappings":"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","sources":["webpack://webao/./webAO/master.ts","webpack://webao/./webAO/encoding.ts","webpack://webao/webpack/bootstrap","webpack://webao/webpack/startup"],"sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar encoding_1 = require(\"./encoding\");\nvar clientVersion = process.env.npm_package_version;\n// const MASTERSERVER_IP = 'master.aceattorneyonline.com:27014';\nvar serverlist_domain = \"servers.aceattorneyonline.com\";\nvar protocol = window.location.protocol;\nvar serverlist_cache_key = \"masterlist\";\nvar servers = [];\nservers[-1] = {\n    name: \"Localhost\",\n    description: \"This is your computer on port 50001\",\n    ip: \"127.0.0.1\",\n    players: 0,\n    online: \"Localhost\",\n    ws_port: 50001,\n};\nfunction main() {\n    getServerlist().then(function (serverlist) {\n        processServerlist(serverlist);\n    });\n    addServer(servers[-1]);\n    processClientVersion(clientVersion);\n    getMasterVersion().then(function (masterVersion) {\n        processMasterVersion(masterVersion);\n    });\n}\nmain();\n// Fetches the serverlist from the masterserver\n// Returns a properly typed list of servers\nfunction getServerlist() {\n    return __awaiter(this, void 0, void 0, function () {\n        var url, response, data, serverlist, data_1, data_1_1, item, newServer;\n        var e_1, _a;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    url = \"\".concat(protocol, \"//\").concat(serverlist_domain, \"/servers\");\n                    return [4 /*yield*/, fetch(url)];\n                case 1:\n                    response = _b.sent();\n                    if (!response.ok) {\n                        console.error(\"Bad status code from masterserver. status: \".concat(response.status, \", body: \").concat(response.body));\n                        document.getElementById(\"ms_error\").style.display = \"block\";\n                        // If we get a bad status code, try to use the cached serverlist\n                        return [2 /*return*/, getCachedServerlist()];\n                    }\n                    return [4 /*yield*/, response.json()];\n                case 2:\n                    data = _b.sent();\n                    serverlist = [];\n                    try {\n                        for (data_1 = __values(data), data_1_1 = data_1.next(); !data_1_1.done; data_1_1 = data_1.next()) {\n                            item = data_1_1.value;\n                            if (!item.name) {\n                                console.warn(\"Server \".concat(item, \" has no name, skipping\"));\n                                continue;\n                            }\n                            if (!item.ip) {\n                                console.warn(\"Server \".concat(item.name, \" has no ip, skipping\"));\n                                continue;\n                            }\n                            if (!item.description) {\n                                console.warn(\"Server \".concat(item.name, \" has no description, skipping\"));\n                                continue;\n                            }\n                            newServer = {\n                                name: item.name,\n                                description: item.description,\n                                ip: item.ip,\n                                players: item.players || 0,\n                                online: \"Players: \".concat(item.players),\n                            };\n                            if (item.ws_port) {\n                                newServer.ws_port = item.ws_port;\n                            }\n                            if (item.wss_port) {\n                                newServer.wss_port = item.wss_port;\n                            }\n                            // if none of ws_port or wss_port are defined, skip\n                            // Note that this is not an error condition, as many servers only has port (TCP) enabled\n                            // Which means they don't support webAO\n                            if (!newServer.ws_port && !newServer.wss_port) {\n                                continue;\n                            }\n                            serverlist.push(newServer);\n                        }\n                    }\n                    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n                    finally {\n                        try {\n                            if (data_1_1 && !data_1_1.done && (_a = data_1.return)) _a.call(data_1);\n                        }\n                        finally { if (e_1) throw e_1.error; }\n                    }\n                    // Always cache the result when we get it\n                    localStorage.setItem(serverlist_cache_key, JSON.stringify(serverlist));\n                    return [2 /*return*/, serverlist];\n            }\n        });\n    });\n}\nfunction getCachedServerlist() {\n    // If it's not in the cache, return an empty list\n    var cached = localStorage.getItem(serverlist_cache_key) || \"[]\";\n    return JSON.parse(cached);\n}\n// Constructs the client URL robustly, independent of domain and path\nfunction constructClientURL(protocol) {\n    var clientURL = new URL(window.location.href);\n    // Use the given protocol\n    clientURL.protocol = protocol;\n    // Remove the last part of the pathname (e.g., \"index.html\")\n    var pathname = clientURL.pathname;\n    var parts = pathname.split(\"/\");\n    parts.pop();\n    // Reconstruct the pathname\n    clientURL.pathname = parts.join(\"/\");\n    // If clientURL.pathname does not end with a slash, add one\n    if (clientURL.pathname[clientURL.pathname.length - 1] !== \"/\") {\n        clientURL.pathname += \"/\";\n    }\n    clientURL.pathname += \"client.html\";\n    return clientURL.href;\n}\nfunction addServer(server) {\n    var ws_port = 0;\n    var ws_protocol = \"\";\n    var http_protocol = \"\";\n    if (server.ws_port) {\n        ws_port = server.ws_port;\n        ws_protocol = \"ws\";\n        http_protocol = \"http\";\n    }\n    if (server.wss_port && !window.navigator.userAgent.includes(\"Nintendo\")) {\n        ws_port = server.wss_port;\n        ws_protocol = \"wss\";\n        http_protocol = \"https\";\n    }\n    if (ws_port === 0 || ws_protocol === \"\" || http_protocol === \"\") {\n        console.warn(\"Server \".concat(server.name, \" has no websocket port, skipping\"));\n        return;\n    }\n    var clientURL = constructClientURL(http_protocol);\n    var connect = \"\".concat(ws_protocol, \"://\").concat(server.ip, \":\").concat(ws_port);\n    var serverName = server.name;\n    var fullClientWatchURL = \"\".concat(clientURL, \"?mode=watch&connect=\").concat(connect, \"&serverName=\").concat(serverName);\n    var fullClientJoinURL = \"\".concat(clientURL, \"?mode=join&connect=\").concat(connect, \"&serverName=\").concat(serverName);\n    servers.push(server);\n    document.getElementById(\"masterlist\").innerHTML +=\n        \"<details name=\\\"servers\\\">\" +\n            \"<summary><p>\".concat((0, encoding_1.safeTags)(server.name), \" (\").concat(server.players, \")</p>\") +\n            \"<a class=\\\"button\\\" href=\\\"\".concat(fullClientJoinURL, \"\\\" target=\\\"_blank\\\">Join</a>\") +\n            \"<a class=\\\"button\\\" href=\\\"\".concat(fullClientWatchURL, \"\\\" target=\\\"_blank\\\">Watch</a></summary>\") +\n            \"<p>\".concat((0, encoding_1.safeTags)(server.description), \"</p>\") +\n            \"</details>\";\n}\nfunction processServerlist(serverlist) {\n    for (var i = 0; i < serverlist.length; i++) {\n        addServer(serverlist[i]);\n    }\n}\nfunction getMasterVersion() {\n    return __awaiter(this, void 0, void 0, function () {\n        var url, response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    url = \"\".concat(protocol, \"//\").concat(serverlist_domain, \"/version\");\n                    return [4 /*yield*/, fetch(url)];\n                case 1:\n                    response = _a.sent();\n                    if (!response.ok) {\n                        console.error(\"Bad status code from masterserver version check. status: \".concat(response.status, \", body: \").concat(response.body));\n                        return [2 /*return*/, \"Unknown\"];\n                    }\n                    return [4 /*yield*/, response.text()];\n                case 2: return [2 /*return*/, _a.sent()];\n            }\n        });\n    });\n}\nfunction processClientVersion(data) {\n    document.getElementById(\"clientinfo\").innerHTML = \"Client version: \".concat(data);\n}\nfunction processMasterVersion(data) {\n    document.getElementById(\"serverinfo\").innerHTML =\n        \"Master server version: \".concat(data);\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.escapeChat = escapeChat;\nexports.unescapeChat = unescapeChat;\nexports.safeTags = safeTags;\nexports.decodeChat = decodeChat;\nexports.prepChat = prepChat;\n/**\n * Escapes a string to AO1 escape codes.\n * @param {string} estring the string to be escaped\n */\nfunction escapeChat(estring) {\n    return estring\n        .replaceAll(\"#\", \"<num>\")\n        .replaceAll(\"&\", \"<and>\")\n        .replaceAll(\"%\", \"<percent>\")\n        .replaceAll(\"$\", \"<dollar>\");\n}\n/**\n * Unescapes a string to AO1 escape codes.\n * @param {string} estring the string to be unescaped\n */\nfunction unescapeChat(estring) {\n    return estring\n        .replaceAll(\"<num>\", \"#\")\n        .replaceAll(\"<and>\", \"&\")\n        .replaceAll(\"<percent>\", \"%\")\n        .replaceAll(\"<dollar>\", \"$\");\n}\n/**\n * Escapes a string to be HTML-safe.\n *\n * XXX: This is unnecessary if we use `createTextNode` instead!\n * @param {string} unsafe an unsanitized string\n */\nfunction safeTags(unsafe) {\n    if (unsafe) {\n        return unsafe.replaceAll(\">\", \"＞\").replaceAll(\"<\", \"＜\");\n    }\n    return \"\";\n}\n/**\n * Decodes text on client side.\n * @param {string} estring the string to be decoded\n */\nfunction decodeChat(estring) {\n    // Source: https://stackoverflow.com/questions/7885096/how-do-i-decode-a-string-with-escaped-unicode\n    return estring.replace(/\\\\u([\\d\\w]{1,})/gi, function (match, group) {\n        return String.fromCharCode(parseInt(group, 16));\n    });\n}\n/**\n * XXX: a nasty hack made by gameboyprinter.\n * @param {string} msg chat message to prepare for display\n */\nfunction prepChat(msg) {\n    // TODO: make this less awful\n    return safeTags(unescapeChat(decodeChat(msg)));\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(924);\n"],"names":["__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","_","label","sent","trys","ops","g","Object","create","Iterator","prototype","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","__values","o","s","m","i","defineProperty","exports","encoding_1","serverlist_domain","protocol","window","location","serverlist_cache_key","servers","addServer","server","ws_port","ws_protocol","http_protocol","wss_port","navigator","userAgent","includes","clientURL","URL","href","parts","pathname","split","join","constructClientURL","connect","concat","ip","serverName","name","fullClientWatchURL","fullClientJoinURL","document","getElementById","innerHTML","safeTags","players","description","console","warn","online","url","response","data","serverlist","data_1","data_1_1","item","newServer","e_1","_a","_b","fetch","ok","json","error","status","style","display","cached","localStorage","getItem","JSON","parse","e_1_1","return","setItem","stringify","getServerlist","processServerlist","text","getMasterVersion","masterVersion","processMasterVersion","unescapeChat","estring","replaceAll","unsafe","decodeChat","replace","match","group","String","fromCharCode","parseInt","escapeChat","prepChat","msg","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","module","__webpack_modules__"],"sourceRoot":""}