{"version":3,"file":"master.f4fe76f9e5aa4449d614.bundle.js","mappings":"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","sources":["webpack://webao/./webAO/encoding.ts","webpack://webao/./webAO/master.ts","webpack://webao/webpack/bootstrap","webpack://webao/webpack/startup"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.escapeChat = escapeChat;\nexports.unescapeChat = unescapeChat;\nexports.safeTags = safeTags;\nexports.decodeChat = decodeChat;\nexports.prepChat = prepChat;\n/**\n * Escapes a string to AO1 escape codes.\n * @param {string} estring the string to be escaped\n */\nfunction escapeChat(estring) {\n    return estring\n        .replaceAll('#', '<num>')\n        .replaceAll('&', '<and>')\n        .replaceAll('%', '<percent>')\n        .replaceAll('$', '<dollar>');\n}\n/**\n * Unescapes a string to AO1 escape codes.\n * @param {string} estring the string to be unescaped\n */\nfunction unescapeChat(estring) {\n    return estring\n        .replaceAll('<num>', '#')\n        .replaceAll('<and>', '&')\n        .replaceAll('<percent>', '%')\n        .replaceAll('<dollar>', '$');\n}\n/**\n * Escapes a string to be HTML-safe.\n *\n * XXX: This is unnecessary if we use `createTextNode` instead!\n * @param {string} unsafe an unsanitized string\n */\nfunction safeTags(unsafe) {\n    if (unsafe) {\n        return unsafe\n            .replaceAll('>', '＞')\n            .replaceAll('<', '＜');\n    }\n    return '';\n}\n/**\n * Decodes text on client side.\n * @param {string} estring the string to be decoded\n */\nfunction decodeChat(estring) {\n    // Source: https://stackoverflow.com/questions/7885096/how-do-i-decode-a-string-with-escaped-unicode\n    return estring.replace(/\\\\u([\\d\\w]{1,})/gi, function (match, group) { return String.fromCharCode(parseInt(group, 16)); });\n}\n/**\n * XXX: a nasty hack made by gameboyprinter.\n * @param {string} msg chat message to prepare for display\n */\nfunction prepChat(msg) {\n    // TODO: make this less awful\n    return safeTags(unescapeChat(decodeChat(msg)));\n}\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.setServ = setServ;\nvar encoding_1 = require(\"./encoding\");\nvar clientVersion = process.env.npm_package_version;\n// const MASTERSERVER_IP = 'master.aceattorneyonline.com:27014';\nvar serverlist_domain = 'servers.aceattorneyonline.com';\nvar protocol = window.location.protocol;\nvar serverlist_cache_key = 'masterlist';\nvar servers = [];\nservers[-2] = {\n    name: 'Singleplayer',\n    description: 'Build cases, try out new things',\n    ip: '127.0.0.1',\n    players: 0,\n    online: 'Singleplayer',\n    port: 50001,\n};\nservers[-1] = {\n    name: 'Localhost',\n    description: 'This is your computer on port 50001',\n    ip: '127.0.0.1',\n    players: 0,\n    online: 'Localhost',\n    port: 50001,\n};\nfunction main() {\n    getServerlist().then(function (serverlist) {\n        processServerlist(serverlist);\n    });\n    processClientVersion(clientVersion);\n    getMasterVersion().then(function (masterVersion) {\n        processMasterVersion(masterVersion);\n    });\n}\nmain();\nfunction setServ(ID) {\n    var server = servers[ID];\n    var onlineStr = server.online;\n    var serverDesc = (0, encoding_1.safeTags)(server.description);\n    document.getElementById('serverdescription_content').innerHTML = \"<b>\".concat(onlineStr, \"</b><br>\").concat(serverDesc);\n}\nwindow.setServ = setServ;\n// Fetches the serverlist from the masterserver\n// Returns a properly typed list of servers\nfunction getServerlist() {\n    return __awaiter(this, void 0, void 0, function () {\n        var url, response, data, serverlist, data_1, data_1_1, item, newServer;\n        var e_1, _a;\n        return __generator(this, function (_b) {\n            switch (_b.label) {\n                case 0:\n                    url = \"\".concat(protocol, \"//\").concat(serverlist_domain, \"/servers\");\n                    return [4 /*yield*/, fetch(url)];\n                case 1:\n                    response = _b.sent();\n                    if (!response.ok) {\n                        console.error(\"Bad status code from masterserver. status: \".concat(response.status, \", body: \").concat(response.body));\n                        document.getElementById('ms_error').style.display = 'block';\n                        // If we get a bad status code, try to use the cached serverlist\n                        return [2 /*return*/, getCachedServerlist()];\n                    }\n                    return [4 /*yield*/, response.json()];\n                case 2:\n                    data = _b.sent();\n                    serverlist = [];\n                    try {\n                        for (data_1 = __values(data), data_1_1 = data_1.next(); !data_1_1.done; data_1_1 = data_1.next()) {\n                            item = data_1_1.value;\n                            if (!item.name) {\n                                console.warn(\"Server \".concat(item, \" has no name, skipping\"));\n                                continue;\n                            }\n                            if (!item.ip) {\n                                console.warn(\"Server \".concat(item.name, \" has no ip, skipping\"));\n                                continue;\n                            }\n                            if (!item.description) {\n                                console.warn(\"Server \".concat(item.name, \" has no description, skipping\"));\n                                continue;\n                            }\n                            newServer = {\n                                name: item.name,\n                                description: item.description,\n                                ip: item.ip,\n                                players: item.players || 0,\n                                online: \"Players: \".concat(item.players),\n                            };\n                            if (item.ws_port) {\n                                newServer.ws_port = item.ws_port;\n                            }\n                            if (item.wss_port) {\n                                newServer.wss_port = item.wss_port;\n                            }\n                            // if none of ws_port or wss_port are defined, skip\n                            // Note that this is not an error condition, as many servers only has port (TCP) enabled\n                            // Which means they don't support webAO\n                            if (!newServer.ws_port && !newServer.wss_port) {\n                                continue;\n                            }\n                            serverlist.push(newServer);\n                        }\n                    }\n                    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n                    finally {\n                        try {\n                            if (data_1_1 && !data_1_1.done && (_a = data_1.return)) _a.call(data_1);\n                        }\n                        finally { if (e_1) throw e_1.error; }\n                    }\n                    // Always cache the result when we get it\n                    localStorage.setItem(serverlist_cache_key, JSON.stringify(serverlist));\n                    return [2 /*return*/, serverlist];\n            }\n        });\n    });\n}\nfunction getCachedServerlist() {\n    // If it's not in the cache, return an empty list\n    var cached = localStorage.getItem(serverlist_cache_key) || '[]';\n    return JSON.parse(cached);\n}\n// Constructs the client URL robustly, independent of domain and path\nfunction constructClientURL(protocol) {\n    var clientURL = new URL(window.location.href);\n    // Use the given protocol\n    clientURL.protocol = protocol;\n    // Remove the last part of the pathname (e.g., \"index.html\")\n    var pathname = clientURL.pathname;\n    var parts = pathname.split('/');\n    parts.pop();\n    // Reconstruct the pathname\n    clientURL.pathname = parts.join('/');\n    // If clientURL.pathname does not end with a slash, add one\n    if (clientURL.pathname[clientURL.pathname.length - 1] !== '/') {\n        clientURL.pathname += '/';\n    }\n    clientURL.pathname += \"client.html\";\n    return clientURL.href;\n}\nfunction processServerlist(serverlist) {\n    for (var i = 0; i < serverlist.length; i++) {\n        var server = serverlist[i];\n        var ws_port = 0;\n        var ws_protocol = '';\n        var http_protocol = '';\n        if (server.ws_port) {\n            ws_port = server.ws_port;\n            ws_protocol = 'ws';\n            http_protocol = 'http';\n        }\n        if (server.wss_port && !window.navigator.userAgent.includes(\"Nintendo\")) {\n            ws_port = server.wss_port;\n            ws_protocol = 'wss';\n            http_protocol = 'https';\n        }\n        if (ws_port === 0 || ws_protocol === '' || http_protocol === '') {\n            console.warn(\"Server \".concat(server.name, \" has no websocket port, skipping\"));\n            continue;\n        }\n        var clientURL = constructClientURL(http_protocol);\n        var connect = \"\".concat(ws_protocol, \"://\").concat(server.ip, \":\").concat(ws_port);\n        var serverName = server.name;\n        var fullClientWatchURL = \"\".concat(clientURL, \"?mode=watch&connect=\").concat(connect, \"&serverName=\").concat(serverName);\n        var fullClientJoinURL = \"\".concat(clientURL, \"?mode=join&connect=\").concat(connect, \"&serverName=\").concat(serverName);\n        servers.push(server);\n        document.getElementById('masterlist').innerHTML\n            += \"<li id=\\\"server\".concat(i, \"\\\" onmouseover=\\\"setServ(\").concat(i, \")\\\"><p>\").concat((0, encoding_1.safeTags)(server.name), \" (\").concat(server.players, \")</p>\")\n                + \"<a class=\\\"button\\\" href=\\\"\".concat(fullClientWatchURL, \"\\\" target=\\\"_blank\\\">Watch</a>\")\n                + \"<a class=\\\"button\\\" href=\\\"\".concat(fullClientJoinURL, \"\\\" target=\\\"_blank\\\">Join</a></li>\");\n    }\n}\nfunction getMasterVersion() {\n    return __awaiter(this, void 0, void 0, function () {\n        var url, response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    url = \"\".concat(protocol, \"//\").concat(serverlist_domain, \"/version\");\n                    return [4 /*yield*/, fetch(url)];\n                case 1:\n                    response = _a.sent();\n                    if (!response.ok) {\n                        console.error(\"Bad status code from masterserver version check. status: \".concat(response.status, \", body: \").concat(response.body));\n                        return [2 /*return*/, 'Unknown'];\n                    }\n                    return [4 /*yield*/, response.text()];\n                case 2: return [2 /*return*/, _a.sent()];\n            }\n        });\n    });\n}\nfunction processClientVersion(data) {\n    document.getElementById('clientinfo').innerHTML = \"Client version: \".concat(data);\n}\nfunction processMasterVersion(data) {\n    document.getElementById('serverinfo').innerHTML = \"Master server version: \".concat(data);\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(924);\n"],"names":["unescapeChat","estring","replaceAll","safeTags","unsafe","decodeChat","replace","match","group","String","fromCharCode","parseInt","Object","defineProperty","exports","value","escapeChat","prepChat","msg","__awaiter","this","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","f","y","t","_","label","sent","trys","ops","g","create","Iterator","prototype","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","__values","o","s","m","i","setServ","encoding_1","serverlist_domain","protocol","window","location","serverlist_cache_key","servers","ID","server","onlineStr","online","serverDesc","description","document","getElementById","innerHTML","concat","constructClientURL","clientURL","URL","href","parts","pathname","split","join","name","ip","players","port","url","response","data","serverlist","data_1","data_1_1","item","newServer","e_1","_a","_b","fetch","ok","json","console","error","status","style","display","cached","localStorage","getItem","JSON","parse","ws_port","wss_port","warn","e_1_1","return","setItem","stringify","getServerlist","ws_protocol","http_protocol","navigator","userAgent","includes","connect","serverName","fullClientWatchURL","fullClientJoinURL","processServerlist","text","getMasterVersion","masterVersion","processMasterVersion","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","module","__webpack_modules__"],"sourceRoot":""}